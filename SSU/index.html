<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" name="viewport">
    <title>InterAgency Flood Assessment</title>

    <!-- Bootstrap -->
    <link type="text/css" rel="stylesheet" href="css/bootstrap.css">
    <link type="text/css" href="css/leaflet.css" rel="stylesheet"/>
    <link type="text/css" href="css/leaflet.markercluster.css" rel="stylesheet"/>

    <link rel="stylesheet" type="text/css" href="css/dc.css">
    <!-- Add IntroJs styles  -->
    <link rel="stylesheet" type="text/css" href="css/introjs.css">
    <link rel="stylesheet" type="text/css" href="css/dashboard.css">
    <link href="css/stylish-portfolio.css" rel="stylesheet">
    <link href="font-awesome-4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


</head>


<body>
 <!-- <a id="menu-toggle" href="#" class="btn btn-dark btn-lg toggle"><i class="fa fa-bars"></i></a>
<nav id="sidebar-wrapper">
    <ul class="sidebar-nav">
        <a id="menu-close" href="#" class="btn btn-light btn-lg pull-right toggle"><i class="fa fa-times"></i></a>
        <li class="sidebar-brand">
            <a href="#top">Dashboard</a>
        </li>
        <li>
            <a href="#gen">General Info</a>
        </li>
        <li>
            <a href="#map">Map</a>
        </li>
        <li>
            <a href="#dem">Demographic</a>
        </li>
        <li>
            <a href="#WASH">WASH</a>
        </li>
        <li>
            <a href="#Shelter">Shelter</a>
        </li>
        <li>
            <a href="#health">Health</a>
        </li>
        <li>
            <a href="#assist">Assistance</a>
        </li>
        <li>
            <a href="#obs">Observation</a>
        </li>
    </ul>
</nav>-->
    <div style="display: block;" class="container" id="dashboard">
      <p id="title"><h3>LBN - Akkar Governorate -- SSU</h3></p>
            <div class="row" id="cccm">
                <div class="col-md-10">
                 <br><a class="reset btn btn-primary btn-sm" id="reset" href="#">Reset All</a><br><br>
                  <div  data-step="7" data-intro="Click on the map to filter by site" data-position="left">
                    <h4 id="map">Map: Location of the Informal Settlements assessed</h4>
                      <p><small><i>Zoom on the map to filter sites</i></small></p>
                    <div  class="map" id="cccm"  > </div>
                </div>
                 <p id="gen"><h3>General Information</h3></p>
                     <div class="row">
                      <div  class="col-md-3">
                        <div  class="vill" id="cccm" class="dc-chart">
                          <h4>Village</h4>
                        </div>
                      </div>
                      <div  class="col-md-3">
                        <div  class="organisation" id="cccm" class="dc-chart">
                          <h4>Organisation</h4>
                        </div>
                      </div>
                       <div  class="col-md-3">
                        <div  class="start_dates" id="cccm" class="dc-chart">
                          <h4>start_dates </h4>
                        </div>
                      </div>
                      <div  class="col-md-2">
                        <div  class="end_dates" id="cccm" class="dc-chart">
                          <h4>end date </h4>
                        </div>
                      </div>
                      <div  class="col-md-3">
                        <div  class="WASH_Shelter_both" id="cccm" class="dc-chart">
                          <h4>WASH_Shelter_both</h4>
                        </div>
                      </div>
                      <div  class="col-md-3">
                        <div  class="Direct_Contractor_Voucher" id="cccm" class="dc-chart">
                          <h4>Direct_Contractor_Voucher</h4>
                        </div>
                      </div>
                       <div  class="col-md-3">
                        <div  class="unfinished_Garages_ICS" id="cccm" class="dc-chart">
                          <h4>unfinished_Garages_ICS</h4>
                        </div>
                      </div>
                    </div>

                </div>
            </div>
              
        </div>
    </div>


    <script type="text/javascript" src="js/intro.js"></script>
    <script type="text/javascript" src="js/d3_002.js"></script>
    <script type="text/javascript" src="js/d3.js"></script>
    <script type="text/javascript" src="js/crossfilter.js"></script>
    <script type="text/javascript" src="js/dc.js"></script>

    <script type="text/javascript" src="js/jquery.js"></script>

<!--maps-->
    <script type="text/javascript" src="js/leaflet.js"></script>
    <script type="text/javascript" src="js/leaflet.markercluster.js"></script>
    <script type="text/javascript" src="js/dc.leaflet.js"></script>



<script type="text/javascript">

/*     Markers      */
//var numberFormat = d3.format(",f");

d3.tsv("data/ssu.tsv", function(data) {
 // drawMarkerSelect(data);
  drawMarkerArea(data);
});


function regroup(dim, cols) {
    var _groupAll = dim.groupAll().reduce(
        function(p, v) { // add
            cols.forEach(function(c) {
                p[c] += v[c];
            });
            return p;
        },
        function(p, v) { // remove
            cols.forEach(function(c) {
                p[c] -= v[c];
            });
            return p;
        },
        function() { // init
            var p = {};
            cols.forEach(function(c) {
                p[c] = 0;
            });
            return p;
        });
    return {
        all: function() {
            // or _.pairs, anything to turn the object into an array
            return d3.map(_groupAll.value()).entries();
        }
    };
}



function drawMarkerArea(data) {
//function drawMarkerSelect(data) {

    data.forEach(function (d) {
    //d.dd  = dateFormat.parse(d.start);
    //d.day = d3.time.day(d.dd);
    //convert to numbers
   // d.num_of_hou = +d['num_of_hou'];
    //d.AssessmentG2Q2_12_individual_Syrian_refugees_live_in_household_property_ = +d.AssessmentG2Q2_12_individual_Syrian_refugees_live_in_household_property_;
  });

  var xf = crossfilter(data);


  var groupname = "marker-select";

  var facilities = xf.dimension(function(d) { return d.geo; });
  var facilitiesGroup = facilities.group();

  dc.leafletMarkerChart(".map",groupname)
      .dimension(facilities)
      .group(facilitiesGroup)
      .width(950)
      .height(300)
      .center([34.53484,36.16699])
      .zoom(11)
      .cluster(true)
      .renderPopup(false)
      .filterByArea(true)
      //.clusterObject({ maxClusterRadius: 40, disableClusteringAtZoom:10,spiderfyOnMaxZoom: false,showCoverageOnHover: false})
    ;

  var vill = xf.dimension(function(d) { return d['Village']; });
  var villsect = vill.group();
  var villbyorg = vill.group().reduceSum(function (d) { return d.org; });

  dc.rowChart("#cccm .vill",groupname)
        .dimension(vill)
        .group(villsect)
       // .group(districtsByMen, "Men")
       //.stack(villbyorg, "Women")
       // .stack(districtsByBoy, "Boys")
       // .stack(districtsByGirl, "Girls")
        .elasticX(true)
        //.data(function(group) { return group.top(10); })
        .width(300)
        .height(3700)
        .renderLabel(true)
        .ordering(function (p) { return -p.value;})
        .colors(['#3182bd'])
        .colorDomain([0,0])
        .colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

  var orgDim  = xf.dimension(function(d) { return d['Org']; });
  var orgsect = orgDim.group().reduceCount();

  dc.rowChart("#cccm .organisation",groupname)
        .dimension(orgDim)
        .group(orgsect)
       // .group(districtsByMen, "Men")
       //.stack(villbyorg, "Women")
       // .stack(districtsByBoy, "Boys")
       // .stack(districtsByGirl, "Girls")
        .elasticX(true)
        //.data(function(group) { return group.top(10); })
        .width(250)
        .height(200)
        .renderLabel(true)
        .ordering(function (p) { return -p.value;})
        .colors(['#3182bd'])
        .colorDomain([0,0])
        .colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

 var stdateDim = xf.dimension(function(d) { return d['start_dates']; });
var stdategp = stdateDim.group();


  dc.rowChart("#cccm .start_dates",groupname)
        .dimension(stdateDim)
        .group(stdategp)
       // .group(districtsByMen, "Men")
       //.stack(villbyorg, "Women")
       // .stack(districtsByBoy, "Boys")
       // .stack(districtsByGirl, "Girls")
        .elasticX(true)
        //.data(function(group) { return group.top(10); })
        .width(250)
        .height(250)
        .renderLabel(true)
        .ordering(function (p) { return -p.value;})
        .colors(['#3182bd'])
        .colorDomain([0,0])
        .colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

var eddateDim = xf.dimension(function(d) { return d['end_dates']; });
var eddategp = eddateDim.group();

  dc.rowChart("#cccm .end_dates",groupname)
        .dimension(eddateDim)
        .group(eddategp)
       // .group(districtsByMen, "Men")
       //.stack(villbyorg, "Women")
       // .stack(districtsByBoy, "Boys")
       // .stack(districtsByGirl, "Girls")
        .elasticX(true)
        //.data(function(group) { return group.top(10); })
        .width(250)
        .height(250)
        .renderLabel(true)
        .ordering(function (p) { return -p.value;})
        .colors(['#3182bd'])
        .colorDomain([0,0])
        .colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

var shwDim = xf.dimension(function(d) { return d['WASH_Shelter_both']; });
var shwgp = shwDim.group();

  dc.rowChart("#cccm .WASH_Shelter_both",groupname)
        .dimension(shwDim)
        .group(shwgp)
       // .group(districtsByMen, "Men")
       //.stack(villbyorg, "Women")
       // .stack(districtsByBoy, "Boys")
       // .stack(districtsByGirl, "Girls")
        .elasticX(true)
        //.data(function(group) { return group.top(10); })
        .width(250)
        .height(250)
        .renderLabel(true)
        .ordering(function (p) { return -p.value;})
        .colors(['#3182bd'])
        .colorDomain([0,0])
        .colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));


var Direct_Contractor_VoucherDim = xf.dimension(function(d) { return d['Direct_Contractor_Voucher']; });
var Direct_Contractor_Vouchergp = Direct_Contractor_VoucherDim.group();

  dc.rowChart("#cccm .Direct_Contractor_Voucher",groupname)
        .dimension(Direct_Contractor_VoucherDim)
        .group(Direct_Contractor_Vouchergp)
       // .group(districtsByMen, "Men")
       //.stack(villbyorg, "Women")
       // .stack(districtsByBoy, "Boys")
       // .stack(districtsByGirl, "Girls")
        .elasticX(true)
        //.data(function(group) { return group.top(10); })
        .width(250)
        .height(250)
        .renderLabel(true)
        .ordering(function (p) { return -p.value;})
        .colors(['#3182bd'])
        .colorDomain([0,0])
        .colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));



var unfinished_Garages_ICSDim = xf.dimension(function(d) { return d['unfinished_Garages_ICS']; });
var unfinished_Garages_ICSgp = unfinished_Garages_ICSDim.group();

  dc.rowChart("#cccm .unfinished_Garages_ICS",groupname)
        .dimension(unfinished_Garages_ICSDim)
        .group(unfinished_Garages_ICSgp)
       // .group(districtsByMen, "Men")
       //.stack(villbyorg, "Women")
       // .stack(districtsByBoy, "Boys")
       // .stack(districtsByGirl, "Girls")
        .elasticX(true)
        //.data(function(group) { return group.top(10); })
        .width(250)
        .height(250)
        .renderLabel(true)
        .ordering(function (p) { return -p.value;})
        .colors(['#3182bd'])
        .colorDomain([0,0])
        .colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

$('#reset').on('click', function (){
  dc.filterAll(groupname);
  dc.redrawAll(groupname);
  return false;
})


  dc.renderAll(groupname);
}

</script>

 <script src="js/bootstrap.js"></script>
<!-- Custom Theme JavaScript -->
<script>
// Closes the sidebar menu
$("#menu-close").click(function(e) {
    e.preventDefault();
    $("#sidebar-wrapper").toggleClass("active");
});

// Opens the sidebar menu
$("#menu-toggle").click(function(e) {
    e.preventDefault();
    $("#sidebar-wrapper").toggleClass("active");
});

// Scrolls to the selected menu item on the page
$(function() {
    $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') || location.hostname == this.hostname) {

            var target = $(this.hash);
            target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
            if (target.length) {
                $('html,body').animate({
                    scrollTop: target.offset().top
                }, 1000);
                return false;
            }
        }
    });
});
</script>

</body>


</html>
